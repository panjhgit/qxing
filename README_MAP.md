# 地图系统使用说明

## 功能特性

### 🗺️ 地图规格
- **地图尺寸**: 6000 x 6000 像素
- **建筑物尺寸**: 750 x 750 像素
- **街道宽度**: 500 像素
- **网格布局**: 自动计算最佳网格排列

### 🏢 建筑物类型
- **民房** 🏠 - 棕色，基础住宅
- **别墅** 🏰 - 金色，高级住宅
- **医院** 🏥 - 红色，医疗设施
- **商店** 🏪 - 青色，商业设施
- **学校** 🏫 - 蓝色，教育设施
- **警察局** 👮 - 绿色，安全设施

### 🎮 交互功能
- **触摸拖动**: 移动地图视角
- **建筑物点击**: 查看建筑物信息
- **返回首页**: 右上角返回按钮
- **地图边界**: 红色边框显示地图范围

## 使用方法

### 1. 进入地图
点击首页的"开始游戏"按钮后，游戏会自动切换到地图模式。

### 2. 地图导航
- **拖动地图**: 触摸屏幕并拖动来移动地图视角
- **查看建筑物**: 点击建筑物查看详细信息
- **返回首页**: 点击右上角的"返回首页"按钮

### 3. 地图信息
左上角显示地图的基本信息：
- 地图尺寸
- 建筑物尺寸
- 街道宽度

## 技术实现

### 地图生成
```javascript
// 自动计算网格数量
const gridCols = Math.floor(mapWidth / (blockSize + streetWidth));
const gridRows = Math.floor(mapHeight / (blockSize + streetWidth));

// 随机分配建筑物类型
const buildingType = buildingTypes[Math.floor(Math.random() * buildingTypes.length)];
```

### 性能优化
- **视口裁剪**: 只渲染可见区域内的建筑物
- **触摸事件**: 支持触摸拖动和点击检测
- **内存管理**: 高效的地图数据结构

### 触摸事件处理
```javascript
// 触摸开始
handleGameTouch(e) {
    // 检查按钮点击
    // 检查建筑物点击
    // 开始拖动
}

// 触摸移动
handleGameTouchMove(e) {
    // 移动地图视角
    mapSystem.moveMap(deltaX, deltaY);
}
```

## 自定义配置

### 修改地图尺寸
在 `MapSystem` 构造函数中修改：
```javascript
constructor(canvas, ctx) {
    this.mapWidth = 8000;    // 修改地图宽度
    this.mapHeight = 6000;   // 修改地图高度
    this.blockSize = 800;    // 修改建筑物尺寸
    this.streetWidth = 600;  // 修改街道宽度
}
```

### 添加新建筑物类型
在 `buildingTypes` 数组中添加：
```javascript
this.buildingTypes = [
    // 现有类型...
    { name: '新建筑', color: '#FF00FF', icon: '🏭' }
];
```

### 修改建筑物外观
在 `drawBuilding` 方法中自定义：
```javascript
drawBuilding(building) {
    // 自定义建筑物样式
    // 自定义图标和文字
    // 添加特殊效果
}
```

## 扩展功能

### 1. 建筑物交互
- 添加建筑物进入功能
- 实现建筑物升级系统
- 添加建筑物状态管理

### 2. 地图装饰
- 添加树木和绿化
- 实现天气效果
- 添加动态元素

### 3. 多人功能
- 同步地图状态
- 实现玩家标记
- 添加聊天系统

## 注意事项

### 性能考虑
- 地图尺寸过大会影响性能
- 建筑物数量过多会降低渲染速度
- 建议根据设备性能调整地图参数

### 触摸体验
- 触摸灵敏度可调整
- 支持多点触摸（可扩展）
- 触摸反馈优化

### 兼容性
- 支持抖音小游戏环境
- 兼容不同屏幕尺寸
- 响应式设计

## 调试信息

地图系统会在控制台输出详细信息：
```
地图初始化完成，尺寸: 6000 x 6000
地图网格生成完成: 6行 x 6列
地图系统初始化成功
点击了建筑物: 医院
```

## 故障排除

### 地图不显示
1. 检查 `MapSystem` 模块是否正确加载
2. 确认Canvas上下文是否有效
3. 查看控制台错误信息

### 触摸无响应
1. 检查触摸事件绑定
2. 确认触摸坐标计算
3. 验证触摸区域设置

### 性能问题
1. 减少地图尺寸
2. 优化渲染逻辑
3. 使用视口裁剪

## 联系支持

如果遇到问题，请：
1. 检查控制台错误信息
2. 确认模块加载状态
3. 验证触摸事件绑定
4. 查看地图初始化日志
